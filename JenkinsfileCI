node('master') {
    checkout scm  // Use SCM configured in Jenkins job for repository URL

    environment {
        data_helper_repo_url = "https://github.com/maramvenkatareddy/node_js.git"
        platform_app_url = "https://github.com/maramvenkatareddy/java-web-app.git"
    }

    try {
        // Read the config file and set the environment
        property = readYaml file: "config.yaml"
        if (ENVIRONMENT == "qa") {
            config = property.qa
            echo "Config: ${config}"
        } else if (ENVIRONMENT == "prod") {
            config = property.prod
            echo "Config: ${config}"
        } else {
            error "ENVIRONMENT variable not set or invalid!"
        }
    } catch (Exception e) {
        error "Failed at reading config file. Error: ${e}"
    }

    try {
        // Clone Datahelper Repository
        stage('Clone Datahelper Repository') {
            dir('repo1') {
                git branch: "main", url: "https://github.com/maramvenkatareddy/node_js.git"
                echo "Checked out Datahelper Repository"
            }
        }

        // Clone Platform Application Repository
        stage('Clone Platform Application Repository') {
            dir('repo2') {
                git branch: "main", url: "https://github.com/maramvenkatareddy/java-web-app.git"
                echo "Checked out Platform Application Repository"
            }
        }

        // Other stages go here...

    } catch (Exception e) {
        error "Pipeline failed with error: ${e}"
    }
}
