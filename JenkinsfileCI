node('master') {
    checkout scm  // Use SCM configured in Jenkins job for repository URL

    environment {
        data_helper_repo_url = "https://github.com/maramvenkatareddy/node_js.git"
        platform_app_url = "https://github.com/maramvenkatareddy/java-web-app.git"
    }

    try {
        // Read the config file and set the environment
        property = readYaml file: "config.yaml"
        if (ENVIRONMENT == "qa") {
            config = property.qa
            echo "Config: ${config}"
        } else if (ENVIRONMENT == "prod") {
            config = property.prod
            echo "Config: ${config}"
        } else {
            error "ENVIRONMENT variable not set or invalid!"
        }
    } catch (Exception e) {
        error "Failed at reading config file. Error: ${e}"
    }

    try {
        // Explicitly clone the public Datahelper repository
        stage('Clone Datahelper Repository') {
            git branch: "${env.GIT_BRANCH}", url: "${env.data_helper_repo_url}"
            echo "Checked out Datahelper Repository"
        }

        // Other stages go here...

    } catch (Exception e) {
        error "Pipeline failed with error: ${e}"
    }
}
